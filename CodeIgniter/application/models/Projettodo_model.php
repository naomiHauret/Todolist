<?php
	class Projettodo_model extends CI_Model{
	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

		public function __construct(){
			$this->load->database(); //construction de notre modèle en chargeant notre BDD (modifier les paramètres de la BDD si besoin dans /config/database)
		}
	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		
		public function user_add_user(){ //ajout d'un utilisateur dans la table user
			$data=array(
				'mailuser'=> $this->input->post('mailInscription'),
				'nomuser'=> $this->input->post('usernameInscription'),
				'passworduser'=> $this->input->post('passInscription')
			);
			return $this->db->insert('prjweb.user',$data); 
		}
		
	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	
		public function fetch_user($mail, $pass){ //cherche dans la base si l'utilisateur avec le mail $mail et le mot de passe $pass existe
						
			$query = "select id from prjweb.user where mailuser=? and  passworduser= ?";

			return $this->db->query($query, array($mail,$pass))->row_array();
		}
	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	public function get_nomuser($mail){
		$query = "select nomuser from prjweb.user where mailuser=?";
		$row = $this->db->query($query, $mail)->row();

		return $row->nomuser;
	}
	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	public function get_iduser($mail){
		$query = "select id from prjweb.user where mailuser=?";
		$row = $this->db->query($query, $mail)->row();

		return $row->id;
	}
	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

		public function get_tasks($loginUser){ //ajoute une tâche à la tasklist de l'utilisateur dont l'identifiant est idUser 
			$query = "select id from prjweb.user where mailuser=?";
			$row = $this->db->query($query, $loginUser)->row();
			
			$idUser= $row->id;
			
			$query = "select intitule, idtask from prjweb.task where iduser=?";
			
			return $this->db->query($query, $idUser)->result_array();
		}
	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		
		public function add_task($iduser){ ///ajoute une tâche à la tasklist de l'utilisateur dont l'identifiant est idUser 
			$data = array(
               'intitule'=> $this->input->post('tache'),
               'iduser' => $iduser,
            );
			
			return $this->db->insert('prjweb.task', $data);  //insertion d'un n-uplet dans la table todo de notre BDD
		}
	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		
		public function delete_task($numTask){ //supprime la tâche d'id $numTask de l'utilisateur d'id $idUser de la BDD
			$data = array('idtask'=>$numTask);
			$this->db->delete('task', $data);
		}
	}
		
?>